<!DOCTYPE html>

<html>
	<head>
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

		<!--link rel="stylesheet" href="../etudes.css"-->


		
		<style>
			.lil-gui.root {
				border-bottom-right-radius: 2em;
				margin: 0em;
				padding: 1em;
				left: 0;
				top: 0;
				position: fixed;
			}
			
			.lil-gui em {
				color: Orange;
				font-weight: bold;
				font-style: normal;
			}
			.lil-gui big {
				font-weight: bold;
				text-transform: uppercase;
			}
			
			#primary {
				position: fixed;
				top: 0.5em;
				left: 0.5em;
				display: inline-block;
			}
			
			#secondary {
				position: fixed;
				top: 0.5em;
				right: 0.5em;
				display: inline-block;
			}
			
			right {
				color: gray;
				font-size: 80%;
				float: right;
			}
			
			.lil-gui .controller.string input {
				font-family: Monospace;
			}
			
		</style>
		<script src="libs/lil-gui.umd.js"></script>
	</head>
	
	<body>
		<div id="primary"></div>
		<div id="secondary"></div>
		<!--h1 class="white">Fluid effects<span id="caption"></span><a href="https://boytchev.github.io/etudes/">&larr;</a></h1-->

		<script type="module">

			import * as THREE from './libs/three.module.min.js';
			import { MAX_LEVEL, updatePlatons, exportPlatonAsGLTF, exportPlatonAsJSON } from './platons.js';
			
			
			var PLATON_TYPES = {
					'<em>T</em>etrahedron': 0,
					'<em>O</em>ctahedron': 1,
					'<em>C</em>ube': 2,
					'<em>D</em>odecahedron': 3,
					'<em>I</em>cosahedron': 4
				}
					
			var EXPORT_TYPES = {
					/*'JPG': 1,*/
					/*'PNG': 2,*/
					'GLB &nbsp;<right>binary</right>': 3,
					'GLTF &nbsp;<right>text</right>': 4,
					'JSON &nbsp;<right>text</right>': 5,
					/*'JS': 4,*/
				}
					
			var mainOptions = {
					geometry: '',
					material: '',
					type: 3, /* JPG */
					action: exportPlaton,
				};
			
			var primaryOptions = {
					type: 0,
					level: 3,
					color: 0x09135D,
					gloss: 0,
				};
			
			var secondaryOptions = {
					type: 1,
					level: 2,
					scale: 47,
					color: 0xffffff,
					gloss: 0,
				};

			var environmentOptions = {
					background: 0,
					light: 0,
				};
				
			// interactive panel for selecting fluid effects
	
			var gui = new lil.GUI({title:'<big>Platon</big>',container:document.getElementById('primary')}),
				geoController = gui.add( mainOptions, 'geometry' ).name( 'Code<right>geometry</right>' ).onChange( onChangeCode ),
				matController = gui.add( mainOptions, 'material' ).name( '<right>material</right>' ).onChange( onChangeCode );
				gui.add( mainOptions, 'type', EXPORT_TYPES ).name( '<right>format</right>' );
				gui.add( mainOptions, 'action' ).name( 'Export' );

			var guiTopology = gui.addFolder( '<big>Topology</big>' );
				guiTopology.add( primaryOptions, 'type', PLATON_TYPES ).name( 'Primary<right>type</right>' ).onChange( onChange );
				guiTopology.add( primaryOptions, 'level' ).min( 1 ).max( MAX_LEVEL ).step( 1 ).name( '<right>level</right>' ).onChange( onChange );
				guiTopology.add( secondaryOptions, 'type', PLATON_TYPES ).name( 'Secondary<right>type</right>' ).onChange( onChange );
				guiTopology.add( secondaryOptions, 'level' ).min( 1 ).max( MAX_LEVEL ).step( 1 ).name( '<right>level</right>' ).onChange( onChange );
				guiTopology.add( secondaryOptions, 'scale' ).min( 1 ).max( 100 ).step( 1 ).name( '<right>scale</right>' ).onChange( onChange );
					
			var guiDecor = gui.addFolder( '<big>Decoration</big>' ).close( );
				guiDecor.addColor( primaryOptions, 'color' ).name( 'Primary<right>color</right>' ).onChange( onChange );
				guiDecor.add( primaryOptions, 'gloss' ).min( -10 ).max( 10 ).step( 1 ).name( '<right>gloss</right>' ).onChange( onChange );
				guiDecor.addColor( secondaryOptions, 'color' ).name( 'Secondary<right>color</right>' ).onChange( onChange );
				guiDecor.add( secondaryOptions, 'gloss' ).min( -10 ).max( 10 ).step( 1 ).name( '<right>gloss</right>' ).onChange( onChange );

			var guiEnvironment = gui.addFolder( '<big>Environment</big>' ).close( );
				guiEnvironment.add( environmentOptions, 'background' ).min( -2 ).max( 2 ).step( 1 ).name( 'Background' ).onChange( onChange );
				guiEnvironment.add( environmentOptions, 'light' ).min( -2 ).max( 2 ).step( 1 ).name( 'Light' ).onChange( onChange );



			function onChange( event )
			{
				updatePlatons( primaryOptions, secondaryOptions, environmentOptions );
				
				
				// TOPOLOGY 
				
				// primary platon
				var geometry = 'TOCDI'[primaryOptions.type];
				if( primaryOptions.level != 1 )
					geometry += primaryOptions.level;
				geometry += ':';
				
				// secondary platon
				geometry += 'TOCDI'[secondaryOptions.type];
				if( secondaryOptions.level != 1 )
					geometry += secondaryOptions.level;
				geometry += '+' + secondaryOptions.scale;
				
				mainOptions.geometry = geometry;
				
				// DECORATION 

				var material = primaryOptions.color.toString(16);
				if( primaryOptions.gloss < 0 )
					material += primaryOptions.gloss;
				else if( primaryOptions.gloss > 0 )
					material += '+' + primaryOptions.gloss;
				material += ':';

				material += secondaryOptions.color.toString(16);
				if( secondaryOptions.gloss < 0 )
					material += secondaryOptions.gloss;
				else if( secondaryOptions.gloss > 0 )
					material += '+' + secondaryOptions.gloss;

				mainOptions.material = material;
				
				
				geoController.updateDisplay( );
				matController.updateDisplay( );

			}
			

			function exportPlaton( )
			{
				switch( mainOptions.type )
				{
					case 3 : exportPlatonAsGLTF( true ); break;
					case 4 : exportPlatonAsGLTF( false ); break;
					case 5 : exportPlatonAsJSON( ); break;
				}
			}
			
			
			function onChangeCode( event )
			{
			}
			
			updatePlatons( primaryOptions, secondaryOptions, environmentOptions );
			onChange( );
		</script>
	</body>
</html>